<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Alarma Compartida</title>
<style>
  body { font-family: Arial; text-align: center; margin-top: 50px; }
  #popup { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; }
  #popupContent { background:white; padding:20px; border-radius:10px; text-align:center; }
  button { padding:15px; font-size:18px; cursor:pointer; }
</style>
<script src="https://js.pusher.com/8.2.0/pusher.min.js"></script>
</head>
<body>

<h2>ðŸš¨ Alarma Global</h2>
<button onclick="sendAlarm()">Enviar alarma</button>

<div id="popup">
  <div id="popupContent">
    <h3>ðŸ”¥ Alarma activada</h3>
    <button onclick="stopAlarm()">Detener alarma</button>
  </div>
</div>

<audio id="alarmSound">
  <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
</audio>

<script>
  // ConfiguraciÃ³n de Pusher (usa tus claves reales)
  const pusher = new Pusher("TU_PUSHER_KEY", { cluster: "TU_CLUSTER" });
  const channel = pusher.subscribe("alarma-global");

  const alarma = document.getElementById("alarmSound");
  const popup = document.getElementById("popup");

  // Escucha eventos desde Pusher
  channel.bind("alarma-activada", () => {
    alarma.loop = true;
    alarma.play();
    popup.style.display = "flex";
  });

  channel.bind("alarma-detener", () => {
    alarma.pause();
    alarma.currentTime = 0;
    popup.style.display = "none";
  });

  // FunciÃ³n para activar alarma (cliente)
  function sendAlarm() {
    fetch(`https://api.pusherapp.com/apps/TU_PUSHER_APP_ID/events`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer TU_PUSHER_KEY" // O tu auth token si es necesario
      },
      body: JSON.stringify({
        name: "alarma-activada",
        channels: ["alarma-global"],
        data: "{}"
      })
    }).catch(e => console.error("No se pudo enviar la alarma:", e));
  }

  // FunciÃ³n para detener alarma (cliente)
  function stopAlarm() {
    fetch(`https://api.pusherapp.com/apps/TU_PUSHER_APP_ID/events`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer TU_PUSHER_KEY"
      },
      body: JSON.stringify({
        name: "alarma-detener",
        channels: ["alarma-global"],
        data: "{}"
      })
    }).catch(e => console.error("No se pudo detener la alarma:", e));
  }
</script>

</body>
</html>
